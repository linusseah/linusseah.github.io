<svg viewBox="0 0 1200 500" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .box-title { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; font-size: 14px; font-weight: 600; fill: white; text-anchor: middle; }
      .box-sublabel { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; font-size: 10px; fill: white; text-anchor: middle; }
      .section-label { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; font-size: 12px; font-weight: 500; fill: #475569; text-anchor: middle; }
      .diagram-title { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; font-size: 20px; font-weight: 700; fill: #1e293b; }
      .description { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; font-size: 12px; fill: #64748b; text-anchor: middle; }
      .arrow { stroke: #94a3b8; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .sidebar-label { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; font-size: 11px; fill: #64748b; text-anchor: end; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#94a3b8" />
    </marker>
  </defs>

  <!-- Background -->
  <rect width="1200" height="500" fill="white"/>

  <!-- Title -->
  <text x="600" y="30" class="diagram-title">v1.5: The Smarter Pipeline</text>

  <!-- Main pipeline boxes -->

  <!-- Cron Trigger -->
  <rect x="30" y="80" width="110" height="75" rx="8" fill="#6366f1" stroke="#e0e7ff" stroke-width="1"/>
  <text x="85" y="118" class="box-title">Cron Trigger</text>
  <text x="85" y="130" class="box-sublabel">Scheduled</text>

  <!-- Arrow -->
  <line x1="140" y1="117" x2="175" y2="117" class="arrow"/>

  <!-- Fetch Sources -->
  <rect x="175" y="80" width="110" height="75" rx="8" fill="#6366f1" stroke="#e0e7ff" stroke-width="1"/>
  <text x="230" y="118" class="box-title">Fetch Sources</text>
  <text x="230" y="130" class="box-sublabel">RSS + IMAP</text>

  <!-- Arrow -->
  <line x1="285" y1="117" x2="320" y2="117" class="arrow"/>

  <!-- Curation Layer (NEW - emerald) -->
  <rect x="320" y="80" width="110" height="75" rx="8" fill="#10b981" stroke="#a7f3d0" stroke-width="1"/>
  <text x="375" y="110" class="box-title">Curation Layer</text>
  <text x="375" y="125" class="box-sublabel">LLM scores 0-1</text>
  <rect x="340" y="155" width="70" height="16" rx="3" fill="#d1fae5" stroke="#6ee7b7" stroke-width="0.5"/>
  <text x="375" y="165" class="section-label" font-size="9">NEW STEP</text>

  <!-- Arrow -->
  <line x1="430" y1="117" x2="465" y2="117" class="arrow"/>

  <!-- Editorial Intro (NEW - emerald) -->
  <rect x="465" y="80" width="110" height="75" rx="8" fill="#10b981" stroke="#a7f3d0" stroke-width="1"/>
  <text x="520" y="110" class="box-title">Editorial Intro</text>
  <text x="520" y="125" class="box-sublabel">LLM writes theme</text>
  <rect x="485" y="155" width="70" height="16" rx="3" fill="#d1fae5" stroke="#6ee7b7" stroke-width="0.5"/>
  <text x="520" y="165" class="section-label" font-size="9">NEW STEP</text>

  <!-- Arrow -->
  <line x1="575" y1="117" x2="610" y2="117" class="arrow"/>

  <!-- LLM Summarize (tiered) -->
  <rect x="610" y="80" width="110" height="75" rx="8" fill="#f59e0b" stroke="#fef08a" stroke-width="1"/>
  <text x="665" y="110" class="box-title">LLM Summarize</text>
  <text x="665" y="125" class="box-sublabel">tiered by score</text>

  <!-- Arrow -->
  <line x1="720" y1="117" x2="755" y2="117" class="arrow"/>

  <!-- Build HTML -->
  <rect x="755" y="80" width="110" height="75" rx="8" fill="#6366f1" stroke="#e0e7ff" stroke-width="1"/>
  <text x="810" y="118" class="box-title">Build HTML</text>
  <text x="810" y="130" class="box-sublabel">Template</text>

  <!-- Arrow -->
  <line x1="865" y1="117" x2="900" y2="117" class="arrow"/>

  <!-- Send Email -->
  <rect x="900" y="80" width="110" height="75" rx="8" fill="#6366f1" stroke="#e0e7ff" stroke-width="1"/>
  <text x="955" y="118" class="box-title">Send Email</text>
  <text x="955" y="130" class="box-sublabel">Resend</text>

  <!-- Side input: user_profile.yaml feeding into Curation Layer -->
  <rect x="60" y="200" width="100" height="50" rx="6" fill="#e2e8f0" stroke="#cbd5e1" stroke-width="1"/>
  <text x="110" y="225" class="box-title" fill="#475569">user_profile</text>
  <text x="110" y="238" class="box-sublabel" fill="#64748b">.yaml</text>

  <!-- Arrow from user_profile to Curation Layer -->
  <line x1="160" y1="225" x2="320" y2="140" class="arrow" stroke="#10b981"/>

  <!-- Description at bottom -->
  <text x="600" y="310" class="description" font-weight="600">LLM role: Curation + summarization. Decisions are pre-programmed.</text>
  <rect x="250" y="330" width="700" height="70" rx="4" fill="#f0f4f8" stroke="#cbd5e1" stroke-width="1"/>
  <text x="600" y="355" class="description">The LLM now makes decisions about which items to include and how to present them.</text>
  <text x="600" y="370" class="description">However, the framework for how it makes these decisions (scoring, themes, etc.)</text>
  <text x="600" y="385" class="description">is still entirely pre-programmed and doesn't adapt dynamically.</text>
</svg>